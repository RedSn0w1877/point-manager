import React, { useState, useEffect, useRef, useMemo } from 'react';
import { 
  LayoutDashboard, 
  Trophy, 
  CheckSquare, 
  Book, 
  Plus, 
  Minus, 
  User, 
  Trash2, 
  Zap, 
  Flame, 
  Target, 
  Cpu, 
  FileText,
  ShieldAlert,
  Clock,
  Sparkles,
  Info,
  X
} from 'lucide-react';

const appId = typeof __app_id !== 'undefined' ? __app_id : 'prism-manager-elite';

// --- CONFIG & TIERS ---
const TIERS = [
  { name: 'Bronze', min: 0, max: 200, color: '#f97316', secondary: '#7c2d12', icon: ShieldAlert },
  { name: 'Silver', min: 200, max: 500, color: '#94a3b8', secondary: '#334155', icon: Target },
  { name: 'Gold', min: 500, max: 1000, color: '#eab308', secondary: '#713f12', icon: Trophy },
  { name: 'Platinum', min: 1000, max: 2500, color: '#06b6d4', secondary: '#155e75', icon: Zap },
  { name: 'Diamond', min: 2500, max: 5000, color: '#8b5cf6', secondary: '#4c1d95', icon: Flame },
  { name: 'Apex', min: 5000, max: 1000000, color: '#ec4899', secondary: '#831843', icon: Sparkles }
];

// --- STYLES ---
const styles = `
  @keyframes particle-in {
    0% { transform: translate(var(--x), var(--y)) scale(1.5); opacity: 0; }
    100% { transform: translate(0, 0) scale(0); opacity: 1; }
  }
  @keyframes star-zoom-rotate {
    0% { transform: scale(0) rotate(0deg); opacity: 0; filter: drop-shadow(0 0 0px transparent); }
    30% { transform: scale(1.2) rotate(360deg); opacity: 1; filter: drop-shadow(0 0 20px white); }
    70% { transform: scale(1) rotate(720deg); opacity: 1; }
    100% { transform: scale(10) rotate(1080deg); opacity: 0; }
  }
  @keyframes edge-pulse {
    0%, 100% { box-shadow: inset 0 0 20px transparent; }
    50% { box-shadow: inset 0 0 100px var(--tier-color); }
  }
  @keyframes circle-explode {
    0% { transform: scale(0); border-width: 100px; opacity: 1; }
    100% { transform: scale(4); border-width: 0px; opacity: 0; }
  }
  @keyframes text-shimmer {
    0% { background-position: -200% center; }
    100% { background-position: 200% center; }
  }
  @keyframes twinkle {
    0%, 100% { opacity: 0.2; transform: scale(0.8); }
    50% { opacity: 1; transform: scale(1.2); }
  }
  @keyframes float {
    0%, 100% { transform: translateY(0px); }
    50% { transform: translateY(-5px); }
  }
  .glass-card {
    background: rgba(18, 18, 28, 0.6);
    backdrop-filter: blur(20px);
    border: 1px solid rgba(255, 255, 255, 0.1);
    box-shadow: 0 8px 32px 0 rgba(0, 0, 0, 0.5);
    transition: all 0.3s ease;
  }
  .glass-card:hover {
    border-color: rgba(255, 255, 255, 0.25);
    box-shadow: 0 0 25px rgba(99, 102, 241, 0.3);
    transform: translateY(-2px);
  }
  .prism-text {
    background: linear-gradient(90deg, #fff, var(--tier-color), #fff);
    background-size: 200% auto;
    -webkit-background-clip: text;
    -webkit-text-fill-color: transparent;
    animation: text-shimmer 3s linear infinite;
  }
  .no-scrollbar::-webkit-scrollbar { display: none; }
  
  .glow-btn {
    transition: all 0.2s;
    position: relative;
    overflow: hidden;
  }
  .glow-btn:hover {
    box-shadow: 0 0 15px currentColor;
  }
  .star {
    position: absolute;
    background: white;
    border-radius: 50%;
    animation: twinkle var(--duration) ease-in-out infinite;
    opacity: 0.6;
  }
`;

// --- COMPONENTS ---

const Starfield = () => {
  const stars = useMemo(() => Array.from({ length: 100 }).map((_, i) => ({
    id: i,
    top: `${Math.random() * 100}%`,
    left: `${Math.random() * 100}%`,
    size: `${Math.random() * 2 + 1}px`,
    duration: `${Math.random() * 3 + 2}s`,
    delay: `${Math.random() * 2}s`
  })), []);

  return (
    <div className="fixed inset-0 pointer-events-none z-0">
      {stars.map(s => (
        <div 
          key={s.id} 
          className="star" 
          style={{ 
            top: s.top, 
            left: s.left, 
            width: s.size, 
            height: s.size, 
            '--duration': s.duration,
            animationDelay: s.delay
          }} 
        />
      ))}
      <div className="absolute inset-0 bg-gradient-to-br from-indigo-900/20 via-transparent to-purple-900/20"></div>
    </div>
  );
};

const RankUpOverlay = ({ tier, onClose }) => {
  const [phase, setPhase] = useState('vacuum');

  useEffect(() => {
    const timers = [
      setTimeout(() => setPhase('star'), 1500),
      setTimeout(() => setPhase('boom'), 4000),
      setTimeout(() => setPhase('complete'), 5000),
    ];
    return () => timers.forEach(clearTimeout);
  }, []);

  const particles = useMemo(() => Array.from({ length: 60 }).map((_, i) => ({
    id: i,
    x: (Math.random() - 0.5) * 1200,
    y: (Math.random() - 0.5) * 1200,
    delay: Math.random() * 1
  })), []);

  return (
    <div 
      className={`fixed inset-0 z-[200] flex items-center justify-center bg-black transition-all duration-1000 ${phase !== 'vacuum' ? 'animate-[edge-pulse_2s_infinite]' : ''}`}
      style={{ '--tier-color': tier.color }}
    >
      {phase === 'vacuum' && particles.map(p => (
        <div key={p.id} className="absolute w-1 h-1 bg-white rounded-full animate-[particle-in_1.5s_ease-in_forwards]" style={{ '--x': `${p.x}px`, '--y': `${p.y}px`, animationDelay: `${p.delay}s` }} />
      ))}

      {phase === 'star' && (
        <div className="relative animate-[star-zoom-rotate_3s_ease-in-out_forwards] flex items-center justify-center">
          <svg width="200" height="200" viewBox="0 0 24 24" fill="white">
            <path d="M12 0L14 10L24 12L14 14L12 24L10 14L0 12L10 10L12 0Z" />
          </svg>
        </div>
      )}

      {phase === 'boom' && (
        <div className="absolute inset-0 flex items-center justify-center">
          <div className="w-full h-full absolute animate-[circle-explode_1s_ease-out_forwards] border-white rounded-full" />
          <div className="w-full h-full absolute animate-[circle-explode_1s_ease-out_forwards] border-indigo-500 rounded-full" style={{ animationDelay: '0.1s' }} />
          <div className="w-full h-full absolute animate-[circle-explode_1s_ease-out_forwards] border-purple-500 rounded-full" style={{ animationDelay: '0.2s' }} />
        </div>
      )}

      {phase === 'complete' && (
        <div className="flex flex-col items-center animate-in fade-in zoom-in duration-500">
          <div className="w-40 h-40 rounded-full flex items-center justify-center mb-8 relative">
             <div className="absolute inset-0 blur-3xl opacity-60 rounded-full" style={{ backgroundColor: tier.color }}></div>
             <div className="relative z-10 glass-card p-8 rounded-full border-2" style={{ borderColor: tier.color }}>
                <tier.icon size={64} style={{ color: tier.color }} />
             </div>
          </div>
          <h2 className="text-sm uppercase tracking-widest text-slate-400 mb-2 font-bold">Rank Attained</h2>
          <h1 className="text-6xl font-black text-white mb-10 tracking-tight uppercase" style={{ textShadow: `0 0 30px ${tier.color}` }}>{tier.name}</h1>
          <button 
            onClick={onClose}
            className="px-10 py-4 bg-white text-black text-sm font-bold rounded-full hover:scale-105 active:scale-95 transition-all shadow-[0_0_30px_rgba(255,255,255,0.4)]"
          >
            CONTINUE
          </button>
        </div>
      )}
    </div>
  );
};

const UserCard = ({ user, onDelete, onUpdatePoints }) => {
  const [amount, setAmount] = useState('');
  const tier = TIERS.find(t => user.points >= t.min && user.points < t.max) || TIERS[0];
  const nextTier = TIERS[TIERS.indexOf(tier) + 1];
  const progress = nextTier ? ((user.points - tier.min) / (nextTier.min - tier.min)) * 100 : 100;

  const handleCustom = (mult) => {
    const val = parseInt(amount);
    if (!isNaN(val) && val > 0) {
      onUpdatePoints(user.id, val * mult);
      setAmount('');
    }
  };

  return (
    <div className="glass-card p-6 rounded-3xl relative overflow-hidden group border-l-4" style={{ borderLeftColor: tier.color }}>
      <div className={`absolute top-0 right-0 p-6 opacity-20 group-hover:opacity-40 transition-opacity blur-sm`} style={{ color: tier.color }}>
        <tier.icon size={80} />
      </div>
      
      <div className="relative z-10">
        <div className="flex justify-between items-start mb-6">
          <div>
            <h3 className="text-xl font-bold text-white mb-1">{user.name}</h3>
            <span className="text-xs font-bold uppercase tracking-wider px-2 py-1 rounded bg-white/10" style={{ color: tier.color }}>
              {tier.name}
            </span>
          </div>
          <button onClick={() => onDelete(user.id)} className="text-slate-600 hover:text-red-500 transition-colors bg-black/20 p-2 rounded-lg"><Trash2 size={16} /></button>
        </div>

        <div className="mb-6">
          <div className="flex justify-between items-end mb-2">
            <p className="text-3xl font-black text-white font-mono">{user.points.toLocaleString()}</p>
            <p className="text-[10px] text-slate-400 font-bold uppercase tracking-wider">
               {nextTier ? `Next: ${nextTier.name}` : 'Max Rank'}
            </p>
          </div>
          <div className="h-2 w-full bg-black/40 rounded-full overflow-hidden border border-white/5">
            <div 
              className="h-full transition-all duration-1000 relative" 
              style={{ backgroundColor: tier.color, width: `${progress}%`, boxShadow: `0 0 10px ${tier.color}` }}
            >
              <div className="absolute inset-0 bg-white/20 animate-pulse"></div>
            </div>
          </div>
        </div>

        <div className="flex flex-col gap-3">
          {/* Quick Actions */}
          <div className="flex gap-2">
            <button onClick={() => onUpdatePoints(user.id, 100)} className="flex-1 bg-emerald-500/10 hover:bg-emerald-500/20 text-emerald-400 border border-emerald-500/20 py-2 rounded-xl text-xs font-bold transition-all glow-btn">+100</button>
            <button onClick={() => onUpdatePoints(user.id, -100)} className="flex-1 bg-rose-500/10 hover:bg-rose-500/20 text-rose-400 border border-rose-500/20 py-2 rounded-xl text-xs font-bold transition-all glow-btn">-100</button>
          </div>
          
          {/* Custom Input */}
          <div className="flex gap-2">
            <input 
              type="number" 
              value={amount}
              onChange={(e) => setAmount(e.target.value)}
              placeholder="Amount..."
              className="flex-1 bg-black/40 border border-white/10 rounded-xl px-3 text-xs text-white outline-none focus:border-indigo-500 font-bold placeholder-slate-600"
            />
            <button onClick={() => handleCustom(1)} className="bg-indigo-500/20 hover:bg-indigo-500/40 text-indigo-300 p-2 rounded-xl transition-all border border-indigo-500/20"><Plus size={16}/></button>
            <button onClick={() => handleCustom(-1)} className="bg-orange-500/20 hover:bg-orange-500/40 text-orange-300 p-2 rounded-xl transition-all border border-orange-500/20"><Minus size={16}/></button>
          </div>
        </div>
      </div>
    </div>
  );
};

// --- MAIN APP ---
export default function App() {
  const [view, setView] = useState('dash');
  const [users, setUsers] = useState(() => JSON.parse(localStorage.getItem('prism_v3_users')) || [{ id: 1, name: 'Commander', points: 0 }]);
  const [tasks, setTasks] = useState(() => JSON.parse(localStorage.getItem('prism_v3_tasks')) || []);
  const [journal, setJournal] = useState(() => localStorage.getItem('prism_v3_journal') || '');
  const [rankUpData, setRankUpData] = useState(null);
  const [showLegend, setShowLegend] = useState(false);
  const [energy, setEnergy] = useState(100);
  
  const prevRanks = useRef({});

  // Persistence
  useEffect(() => {
    localStorage.setItem('prism_v3_users', JSON.stringify(users));
    users.forEach(u => {
      const currentTier = TIERS.find(t => u.points >= t.min && u.points < t.max) || TIERS[0];
      if (prevRanks.current[u.id] && prevRanks.current[u.id] !== currentTier.name) {
        setRankUpData(currentTier);
      }
      prevRanks.current[u.id] = currentTier.name;
    });
  }, [users]);

  useEffect(() => localStorage.setItem('prism_v3_tasks', JSON.stringify(tasks)), [tasks]);
  useEffect(() => localStorage.setItem('prism_v3_journal', journal), [journal]);
  
  // Energy simulation
  useEffect(() => {
    const i = setInterval(() => setEnergy(p => p > 90 ? 100 : p + 0.1), 1000);
    return () => clearInterval(i);
  }, []);

  const addPoints = (uid, amt) => {
    setUsers(prev => prev.map(u => u.id === uid ? { ...u, points: Math.max(0, u.points + amt) } : u));
  };

  const addUser = (name) => {
    setUsers([...users, { id: Date.now(), name, points: 0 }]);
  };

  const deleteUser = (id) => {
    if (users.length === 1) return;
    setUsers(users.filter(u => u.id !== id));
  };

  const addTask = (text, reward, uid) => {
    if (!text || !reward || !uid) return;
    setTasks([...tasks, { id: Date.now(), text, reward, uid: Number(uid), done: false }]);
  };

  const completeTask = (tid) => {
    setTasks(prev => prev.map(t => {
      if (t.id === tid && !t.done) {
        addPoints(t.uid, t.reward);
        return { ...t, done: true };
      }
      return t;
    }));
  };

  return (
    <div className="flex h-screen w-full bg-[#050508] text-slate-200 font-sans relative overflow-hidden">
      <style>{styles}</style>
      <Starfield />

      {/* Sidebar */}
      <nav className="w-20 md:w-64 border-r border-white/10 flex flex-col items-center md:items-stretch p-4 z-20 bg-[#0a0a0f]/80 backdrop-blur-md">
        <div className="flex items-center gap-3 mb-10 px-2 mt-2">
          <div className="w-10 h-10 bg-gradient-to-br from-indigo-600 to-purple-600 rounded-xl flex items-center justify-center text-white shadow-lg shadow-indigo-500/30">
            <Zap size={20} fill="currentColor" />
          </div>
          <div className="hidden md:block">
            <h1 className="font-bold text-lg text-white tracking-tight">Prism</h1>
            <p className="text-[10px] text-slate-400 font-bold uppercase tracking-widest">Manager v3.0</p>
          </div>
        </div>

        <div className="space-y-2 flex-1">
          {[
            { id: 'dash', label: 'Launchpad', icon: LayoutDashboard },
            { id: 'users', label: 'Members', icon: User },
            { id: 'quests', label: 'Quests', icon: CheckSquare },
            { id: 'journal', label: 'Logs', icon: Book }
          ].map(item => (
            <button 
              key={item.id} 
              onClick={() => setView(item.id)}
              className={`w-full flex items-center gap-3 p-3 rounded-xl transition-all relative overflow-hidden ${view === item.id ? 'bg-indigo-600/20 text-white shadow-[0_0_15px_rgba(79,70,229,0.3)] border border-indigo-500/30' : 'text-slate-400 hover:text-white hover:bg-white/5'}`}
            >
              <item.icon size={18} className={view === item.id ? 'text-indigo-400' : ''} />
              <span className="hidden md:block text-sm font-bold">{item.label}</span>
              {view === item.id && <div className="absolute right-0 top-0 bottom-0 w-1 bg-indigo-500 shadow-[0_0_10px_#6366f1]"></div>}
            </button>
          ))}
        </div>

        <div className="mt-auto pt-6 border-t border-white/10">
          <div className="glass-card p-3 rounded-xl flex items-center gap-3 bg-emerald-900/10 border-emerald-500/20">
             <div className="w-2 h-2 rounded-full bg-emerald-400 shadow-[0_0_8px_#34d399] animate-pulse"></div>
             <div className="hidden md:block">
                <p className="text-[10px] font-bold text-emerald-400 uppercase tracking-wider">File Status</p>
                <p className="text-xs text-white font-bold">Online</p>
             </div>
          </div>
        </div>
      </nav>

      {/* Main Content */}
      <main className="flex-1 overflow-y-auto relative z-10 no-scrollbar">
        <div className="p-6 md:p-12 max-w-7xl mx-auto space-y-10 pb-32">
          
          {/* VIEW: LAUNCHPAD */}
          {view === 'dash' && (
            <div className="space-y-8 animate-in fade-in slide-in-from-bottom-4 duration-700">
               {/* Header */}
               <div className="flex flex-col md:flex-row justify-between items-end gap-6">
                 <div>
                    <h1 className="text-5xl font-bold text-white mb-2 tracking-tight drop-shadow-[0_0_15px_rgba(255,255,255,0.3)]">Welcome Back</h1>
                    <p className="text-slate-400 font-medium">System operational. All systems green.</p>
                 </div>
                 <div className="text-right">
                    <div className="text-4xl font-bold text-white font-mono drop-shadow-[0_0_10px_rgba(99,102,241,0.5)]">
                      {new Date().toLocaleTimeString([], { hour: '2-digit', minute: '2-digit' })}
                    </div>
                    <div className="text-xs text-indigo-400 font-bold uppercase tracking-widest mt-1">
                      {new Date().toLocaleDateString(undefined, { weekday: 'long', month: 'short', day: 'numeric' })}
                    </div>
                 </div>
               </div>

               {/* KPI Cards */}
               <div className="grid grid-cols-1 md:grid-cols-3 gap-6">
                  <div className="glass-card p-6 rounded-2xl relative overflow-hidden group border-indigo-500/30">
                    <div className="absolute -right-6 -top-6 bg-indigo-500/20 w-32 h-32 rounded-full blur-2xl group-hover:bg-indigo-500/30 transition-all"></div>
                    <Cpu className="text-indigo-400 mb-4" size={32} />
                    <p className="text-sm text-slate-400 font-bold uppercase tracking-wider">CPU Load</p>
                    <p className="text-3xl font-bold text-white mt-1">12%</p>
                  </div>
                  <div className="glass-card p-6 rounded-2xl relative overflow-hidden group border-purple-500/30">
                    <div className="absolute -right-6 -top-6 bg-purple-500/20 w-32 h-32 rounded-full blur-2xl group-hover:bg-purple-500/30 transition-all"></div>
                    <Flame className="text-purple-400 mb-4" size={32} />
                    <p className="text-sm text-slate-400 font-bold uppercase tracking-wider">Energy</p>
                    <p className="text-3xl font-bold text-white mt-1">{Math.floor(energy)}%</p>
                  </div>
                  <div className="glass-card p-6 rounded-2xl relative overflow-hidden group border-pink-500/30">
                    <div className="absolute -right-6 -top-6 bg-pink-500/20 w-32 h-32 rounded-full blur-2xl group-hover:bg-pink-500/30 transition-all"></div>
                    <Target className="text-pink-400 mb-4" size={32} />
                    <p className="text-sm text-slate-400 font-bold uppercase tracking-wider">Active Quests</p>
                    <p className="text-3xl font-bold text-white mt-1">{tasks.filter(t => !t.done).length}</p>
                  </div>
               </div>
            </div>
          )}

          {/* VIEW: MEMBERS */}
          {view === 'users' && (
            <div className="space-y-8 animate-in fade-in slide-in-from-right-4 duration-500">
               <div className="flex flex-col md:flex-row justify-between items-center gap-6 border-b border-white/10 pb-6">
                  <div>
                    <h2 className="text-3xl font-bold text-white tracking-tight">Members</h2>
                    <p className="text-sm text-slate-400 mt-1">Manage team points and ranks</p>
                  </div>
                  <div className="flex gap-3">
                    <button 
                      onClick={() => setShowLegend(true)}
                      className="px-4 py-2 bg-white/5 border border-white/10 text-slate-300 text-xs font-bold rounded-lg hover:bg-white/10 transition-all flex items-center gap-2"
                    >
                      <Info size={14} /> View Key
                    </button>
                    <button 
                      onClick={() => {
                        const n = prompt("Member Name?");
                        if(n) addUser(n);
                      }}
                      className="px-5 py-2 bg-indigo-600 hover:bg-indigo-500 text-white text-xs font-bold rounded-lg shadow-lg shadow-indigo-500/20 transition-all flex items-center gap-2"
                    >
                      <Plus size={16} /> Add Member
                    </button>
                  </div>
               </div>

               <div className="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6">
                  {users.map(u => (
                    <UserCard key={u.id} user={u} onDelete={deleteUser} onUpdatePoints={addPoints} />
                  ))}
               </div>
            </div>
          )}

          {/* VIEW: QUESTS */}
          {view === 'quests' && (
            <div className="space-y-8 animate-in fade-in slide-in-from-right-4 duration-500">
               <div className="border-b border-white/10 pb-6">
                  <h2 className="text-3xl font-bold text-white tracking-tight">Quests</h2>
                  <p className="text-sm text-slate-400 mt-1">Deploy tasks and assign rewards</p>
               </div>

               <div className="glass-card p-6 rounded-2xl border-indigo-500/20">
                  <div className="grid grid-cols-1 md:grid-cols-4 gap-4 mb-4">
                    <input id="t-text" placeholder="Quest Title..." className="md:col-span-2 bg-black/40 border border-white/10 rounded-xl px-4 py-3 text-sm text-white outline-none focus:border-indigo-500 transition-all" />
                    <input id="t-reward" type="number" placeholder="Points" className="bg-black/40 border border-white/10 rounded-xl px-4 py-3 text-sm text-white outline-none focus:border-indigo-500 transition-all" />
                    <select id="t-uid" className="bg-black/40 border border-white/10 rounded-xl px-4 py-3 text-sm text-white outline-none focus:border-indigo-500 transition-all cursor-pointer">
                       {users.map(u => <option key={u.id} value={u.id} className="bg-slate-900">{u.name}</option>)}
                    </select>
                  </div>
                  <button 
                    onClick={() => {
                      const t = document.getElementById('t-text').value;
                      const r = document.getElementById('t-reward').value;
                      const u = document.getElementById('t-uid').value;
                      addTask(t, r, u);
                      document.getElementById('t-text').value = '';
                      document.getElementById('t-reward').value = '';
                    }}
                    className="w-full py-3 bg-indigo-600 hover:bg-indigo-500 text-white font-bold rounded-xl shadow-lg shadow-indigo-500/20 transition-all"
                  >
                    Create Quest
                  </button>
               </div>

               <div className="space-y-3">
                  {tasks.length === 0 && <p className="text-center text-slate-500 py-10 italic">No active quests.</p>}
                  {tasks.map(t => (
                    <div key={t.id} className={`glass-card p-4 rounded-xl flex items-center justify-between group ${t.done ? 'opacity-40 grayscale' : 'hover:border-indigo-500/40'}`}>
                       <div className="flex items-center gap-4">
                          <button 
                            onClick={() => completeTask(t.id)}
                            disabled={t.done}
                            className={`w-6 h-6 rounded-md border-2 flex items-center justify-center transition-all ${t.done ? 'bg-emerald-500 border-emerald-500 text-white' : 'border-slate-600 hover:border-emerald-500 text-transparent hover:text-emerald-500'}`}
                          >
                            <CheckSquare size={14} fill="currentColor" />
                          </button>
                          <div>
                             <p className={`text-sm font-bold ${t.done ? 'line-through text-slate-500' : 'text-white'}`}>{t.text}</p>
                             <div className="flex items-center gap-2 mt-1 text-xs text-slate-400">
                                <span className="text-indigo-400 font-bold">{t.reward} PTS</span>
                                <span>for {users.find(u => u.id === t.uid)?.name}</span>
                             </div>
                          </div>
                       </div>
                       <button onClick={() => setTasks(tasks.filter(x => x.id !== t.id))} className="text-slate-600 hover:text-rose-500 p-2 opacity-0 group-hover:opacity-100 transition-all"><Trash2 size={16} /></button>
                    </div>
                  ))}
               </div>
            </div>
          )}

          {/* VIEW: LOGS */}
          {view === 'journal' && (
            <div className="h-full flex flex-col space-y-6 animate-in fade-in slide-in-from-right-4 duration-500">
               <div className="border-b border-white/10 pb-6">
                  <h2 className="text-3xl font-bold text-white tracking-tight">Logs</h2>
                  <p className="text-sm text-slate-400 mt-1">Personal notes and system records</p>
               </div>
               <div className="flex-1 relative">
                  <textarea 
                    value={journal}
                    onChange={(e) => setJournal(e.target.value)}
                    placeholder="Write your notes here..."
                    className="w-full h-[500px] glass-card rounded-2xl p-6 text-sm text-slate-200 font-sans leading-relaxed outline-none focus:border-indigo-500 transition-all resize-none placeholder-slate-600"
                  />
                  <div className="absolute bottom-4 right-4 text-xs text-slate-500 font-bold bg-black/40 px-3 py-1 rounded-full backdrop-blur-md border border-white/5">
                    Saved locally
                  </div>
               </div>
            </div>
          )}

        </div>
      </main>

      {/* LEGEND MODAL */}
      {showLegend && (
        <div className="fixed inset-0 z-[100] flex items-center justify-center bg-black/80 backdrop-blur-sm p-4 animate-in fade-in duration-200" onClick={() => setShowLegend(false)}>
          <div className="glass-card w-full max-w-lg rounded-2xl overflow-hidden shadow-2xl scale-100" onClick={e => e.stopPropagation()}>
            <div className="p-6 border-b border-white/10 flex justify-between items-center bg-white/5">
              <h3 className="text-xl font-bold text-white">Rank Key</h3>
              <button onClick={() => setShowLegend(false)}><X size={20} className="text-slate-400 hover:text-white" /></button>
            </div>
            <div className="p-6 space-y-3">
              {TIERS.map(t => (
                <div key={t.name} className="flex items-center justify-between p-3 rounded-xl bg-white/5 border border-white/5">
                   <div className="flex items-center gap-3">
                      <t.icon size={18} style={{ color: t.color }} />
                      <span className="font-bold text-slate-200">{t.name}</span>
                   </div>
                   <span className="text-xs font-mono text-slate-500">{t.min.toLocaleString()} - {t.max.toLocaleString()}</span>
                </div>
              ))}
            </div>
          </div>
        </div>
      )}

      {/* RANK UP OVERLAY */}
      {rankUpData && <RankUpOverlay tier={rankUpData} onClose={() => setRankUpData(null)} />}
    </div>
  );
}
