<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>NEXUS OS v5.0 | Prism Edition</title>
    
    <!-- 1. TAILWIND CSS (For the drip) -->
    <script src="https://cdn.tailwindcss.com"></script>
    
    <!-- 2. REACT CORE (The Brain) -->
    <script crossorigin src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    
    <!-- 3. BABEL (The Translator - makes browser understand React) -->
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    
    <!-- 4. LUCIDE ICONS (The Bling) -->
    <script src="https://unpkg.com/lucide@latest"></script>
    <!-- We need a specific script to make Lucide work with React in this standalone mode -->
    <script src="https://unpkg.com/lucide-react@latest/dist/umd/lucide-react.min.js"></script>

    <style>
        /* BASE STYLES - DARK MODE LOCK */
        body {
            background-color: #000000;
            margin: 0;
            padding: 0;
            overflow: hidden;
            font-family: ui-sans-serif, system-ui, -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, "Helvetica Neue", Arial, sans-serif;
            color: #e2e8f0;
        }

        /* CUSTOM SCROLLBARS */
        .custom-scrollbar::-webkit-scrollbar { width: 5px; }
        .custom-scrollbar::-webkit-scrollbar-track { background: transparent; }
        .custom-scrollbar::-webkit-scrollbar-thumb { background: rgba(255,255,255,0.1); border-radius: 10px; }
        .custom-scrollbar::-webkit-scrollbar-thumb:hover { background: rgba(255,255,255,0.2); }

        /* ANIMATIONS */
        @keyframes slide-right { 0% { transform: translateX(-100%); opacity: 0; } 100% { transform: translateX(0); opacity: 1; } }
        .animate-slide-right { animation: slide-right 0.3s ease-out forwards; }
        
        @keyframes fade-in { 0% { opacity: 0; } 100% { opacity: 1; } }
        .animate-fade-in { animation: fade-in 0.5s ease-out forwards; }
        
        @keyframes slide-up { 0% { transform: translateY(30px); opacity: 0; } 100% { transform: translateY(0); opacity: 1; } }
        .animate-slide-up { animation: slide-up 0.6s cubic-bezier(0.16, 1, 0.3, 1) forwards; }
        
        @keyframes spin-slow { 0% { transform: rotate(0deg); } 100% { transform: rotate(360deg); } }
        .animate-spin-slow { animation: spin-slow 2s linear infinite; }
    </style>
</head>
<body>
    <div id="root"></div>

    <!-- MAIN SCRIPT: type="text/babel" is CRITICAL for React to work -->
    <script type="text/babel">
        // --- IMPORTS FROM GLOBALS ---
        const { useState, useEffect, useRef } = React;
        
        // Lucide icons come from the global 'lucideReact' object in UMD build
        const { 
            LayoutDashboard, Trophy, CheckSquare, Book, 
            Settings, Power, Wifi, Battery, Cpu, Search, Bell, Menu, X,
            Plus, Trash2, Calendar, Clock, Cloud, 
            Shield, Zap, Crown, Flame, Star, Hexagon, ArrowUpRight,
            Coins, User, RefreshCw, Smartphone, Signal, Sparkles
        } = lucideReact;

        // --- ROBUST STORAGE HOOK ---
        const useLocalStorage = (key, initialValue) => {
            const [storedValue, setStoredValue] = useState(() => {
                try {
                    const item = window.localStorage.getItem(key);
                    return item ? JSON.parse(item) : initialValue;
                } catch (error) {
                    console.error("Storage Error:", error);
                    return initialValue;
                }
            });
            const setValue = (value) => {
                try {
                    const valueToStore = value instanceof Function ? value(storedValue) : value;
                    setStoredValue(valueToStore);
                    window.localStorage.setItem(key, JSON.stringify(valueToStore));
                } catch (error) {
                    console.error("Set Storage Error:", error);
                }
            };
            return [storedValue, setValue];
        };

        // --- GLOBAL CONSTANTS ---
        const TIERS = [
            { name: 'Bronze', min: 0, max: 120, color: 'from-orange-800 to-orange-600', textColor: 'text-orange-500', icon: Shield },
            { name: 'Silver', min: 120, max: 300, color: 'from-slate-400 to-slate-200', textColor: 'text-slate-300', icon: Shield },
            { name: 'Gold', min: 300, max: 600, color: 'from-yellow-600 to-yellow-300', textColor: 'text-yellow-400', icon: Trophy },
            { name: 'Platinum', min: 600, max: 1000, color: 'from-cyan-600 to-cyan-300', textColor: 'text-cyan-400', icon: Crown },
            { name: 'Diamond', min: 1000, max: 5000, color: 'from-indigo-500 via-purple-500 to-pink-500', textColor: 'text-purple-400', icon: Sparkles },
            { name: 'Obsidian', min: 5000, max: 999999999, color: 'from-black via-slate-900 to-slate-800', textColor: 'text-slate-400', icon: Flame },
        ];

        // --- BACKGROUND ENGINE ---
        const StarryBackground = () => {
            const canvasRef = useRef(null);
            
            useEffect(() => {
                const canvas = canvasRef.current;
                if (!canvas) return;
                const ctx = canvas.getContext('2d');
                
                // Force black immediately
                canvas.style.background = '#000000';
                
                let animationFrameId;

                const resize = () => {
                    canvas.width = window.innerWidth;
                    canvas.height = window.innerHeight;
                };
                window.addEventListener('resize', resize);
                resize();

                const stars = Array.from({ length: 150 }, () => ({
                    x: Math.random() * canvas.width,
                    y: Math.random() * canvas.height,
                    size: Math.random() * 1.5 + 0.1,
                    speedX: (Math.random() - 0.5) * 0.05,
                    speedY: (Math.random() - 0.5) * 0.05,
                    opacity: Math.random(),
                    pulse: Math.random() * 0.02
                }));

                const draw = () => {
                    ctx.fillStyle = 'rgba(0, 0, 0, 0.3)'; 
                    ctx.fillRect(0, 0, canvas.width, canvas.height);

                    const time = Date.now() * 0.0001;
                    const g1 = ctx.createRadialGradient(
                        canvas.width * 0.5 + Math.sin(time) * 100, 
                        canvas.height * 0.5 + Math.cos(time) * 100, 
                        0, 
                        canvas.width * 0.5, 
                        canvas.height * 0.5, 
                        800
                    );
                    g1.addColorStop(0, 'rgba(76, 29, 149, 0.05)');
                    g1.addColorStop(1, 'transparent');
                    ctx.fillStyle = g1;
                    ctx.fillRect(0,0,canvas.width,canvas.height);

                    stars.forEach(star => {
                        star.x += star.speedX;
                        star.y += star.speedY;
                        star.opacity += star.pulse;
                        if (star.opacity > 1 || star.opacity < 0.2) star.pulse = -star.pulse;
                        if(star.x<0) star.x=canvas.width;
                        if(star.x>canvas.width) star.x=0;
                        if(star.y<0) star.y=canvas.height;
                        if(star.y>canvas.height) star.y=0;

                        ctx.beginPath();
                        ctx.arc(star.x, star.y, star.size, 0, Math.PI * 2);
                        ctx.fillStyle = `rgba(255, 255, 255, ${star.opacity})`;
                        ctx.fill();
                    });
                    animationFrameId = requestAnimationFrame(draw);
                };
                draw();
                return () => {
                    window.removeEventListener('resize', resize);
                    cancelAnimationFrame(animationFrameId);
                };
            }, []);
            
            return <canvas ref={canvasRef} className="fixed inset-0 z-0 pointer-events-none" style={{ backgroundColor: '#000000' }} />;
        };

        // --- COMMAND DECK ---
        const Dashboard = ({ users, energy, recharge }) => {
            const [time, setTime] = useState(new Date());
            const [focus, setFocus] = useLocalStorage('nexus_focus', '');
            const [cpuLoad, setCpuLoad] = useState(12);

            useEffect(() => {
                const timer = setInterval(() => setTime(new Date()), 1000);
                const cpuTimer = setInterval(() => {
                    setCpuLoad(prev => Math.min(100, Math.max(5, prev + (Math.random() - 0.5) * 15)));
                }, 2000);
                return () => { clearInterval(timer); clearInterval(cpuTimer); };
            }, []);

            const totalPoints = users ? users.reduce((acc, curr) => acc + (curr.points || 0), 0) : 0;

            const getEnergyStatus = () => {
                if (energy > 60) return { text: 'OPTIMAL', color: 'text-emerald-400', bar: 'bg-emerald-500' };
                if (energy > 20) return { text: 'DRAINING', color: 'text-amber-400', bar: 'bg-amber-500' };
                return { text: 'CRITICAL', color: 'text-rose-500 animate-pulse', bar: 'bg-rose-500' };
            };

            const status = getEnergyStatus();

            return (
                <div className="space-y-6 animate-slide-up pb-20">
                    {/* Hero Card */}
                    <div className="relative overflow-hidden rounded-[2rem] border border-white/10 p-8 md:p-12 shadow-[0_8px_32px_0_rgba(0,0,0,0.36)] backdrop-blur-xl bg-white/5 group transition-all hover:bg-white/10">
                        <div className="absolute inset-0 bg-gradient-to-br from-indigo-500/10 via-transparent to-transparent opacity-50"></div>
                        <div className="absolute top-[-50px] right-[-50px] opacity-20 pointer-events-none group-hover:rotate-[360deg] transition-transform duration-[40s]">
                            <Hexagon size={300} className="text-white drop-shadow-[0_0_15px_rgba(255,255,255,0.3)]" strokeWidth={0.5} />
                        </div>
                        
                        <div className="relative z-10 flex flex-col md:flex-row justify-between items-end gap-6">
                            <div>
                                <h2 className="text-xs font-mono text-indigo-400 tracking-[0.3em] mb-2 flex items-center gap-2">
                                    <span className={`w-2 h-2 rounded-full ${energy > 0 ? 'bg-green-500 shadow-[0_0_10px_#22c55e]' : 'bg-red-500'}`}></span>
                                    NEXUS_OS_V5
                                </h2>
                                <h1 className="text-6xl md:text-8xl font-black text-white mb-2 tracking-tighter drop-shadow-2xl">
                                    {time.toLocaleTimeString([], { hour: '2-digit', minute: '2-digit' })}
                                </h1>
                                <p className="text-slate-300 text-lg font-light tracking-wide flex items-center gap-2">
                                    <Calendar size={18} className="text-indigo-400" />
                                    {time.toLocaleDateString([], { weekday: 'long', month: 'long', day: 'numeric' })}
                                </p>
                            </div>
                            
                            <div className="text-right hidden md:block space-y-1">
                                <div className="text-xl font-bold text-white flex items-center justify-end gap-2 bg-black/20 px-4 py-2 rounded-xl backdrop-blur-md border border-white/5">
                                    <span className="text-indigo-400"><Smartphone size={18}/></span> Sharon, MA
                                </div>
                                <div className="text-sm text-slate-400 font-mono">68°F • Clear Sky</div>
                            </div>
                        </div>
                    </div>

                    <div className="grid grid-cols-1 md:grid-cols-3 gap-6">
                        {/* Focus Input */}
                        <div className="md:col-span-2 bg-[#0a0a0a]/50 border border-white/5 rounded-[2rem] p-8 backdrop-blur-md hover:border-indigo-500/50 transition-all group shadow-lg">
                            <h3 className="text-slate-500 font-bold uppercase tracking-wider text-[10px] mb-4 flex items-center gap-2">
                                <Star size={14} className="text-yellow-500 drop-shadow-[0_0_8px_rgba(234,179,8,0.5)]" /> Primary Directive
                            </h3>
                            <input 
                                type="text" 
                                value={focus}
                                onChange={(e) => setFocus(e.target.value)}
                                placeholder="Enter mission objective..."
                                className="w-full bg-transparent text-2xl md:text-3xl font-bold text-white placeholder-white/10 outline-none border-b border-white/10 focus:border-indigo-500 transition-all pb-4 tracking-tight"
                            />
                        </div>

                        {/* Energy Core */}
                        <div className="bg-[#0a0a0a]/50 border border-white/5 rounded-[2rem] p-6 backdrop-blur-md flex flex-col justify-between relative overflow-hidden group shadow-lg hover:shadow-indigo-500/10 transition-shadow">
                            <div className="flex justify-between items-start relative z-10">
                                <h3 className="text-slate-500 font-bold uppercase tracking-wider text-[10px] flex items-center gap-2">
                                    <Zap size={14} className={status.color} /> Core Integrity
                                </h3>
                                <span className={`text-[10px] font-mono font-bold ${status.color}`}>{status.text}</span>
                            </div>

                            <div className="flex-1 flex items-center justify-center my-4 relative z-10">
                                <div className="text-6xl font-black font-mono tracking-tighter text-white drop-shadow-[0_0_15px_rgba(255,255,255,0.2)]">
                                {Math.floor(energy)}<span className="text-2xl text-slate-500">%</span>
                                </div>
                            </div>

                            <button 
                                onClick={recharge}
                                className="relative z-10 w-full bg-white/5 hover:bg-white/10 border border-white/10 text-white py-3 rounded-xl text-xs font-bold tracking-widest uppercase transition-all active:scale-95 flex items-center justify-center gap-2 group-hover:border-white/20"
                            >
                                <RefreshCw size={14} className={energy < 100 ? "animate-spin-slow" : ""} /> Recharge
                            </button>
                            
                            <div className="absolute bottom-0 left-0 h-1 bg-white/10 w-full">
                                <div className={`h-full transition-all duration-500 ${status.bar}`} style={{ width: `${energy}%` }}></div>
                            </div>
                        </div>
                    </div>

                    {/* Vitals */}
                    <div className="grid grid-cols-2 md:grid-cols-4 gap-4">
                        {[
                        { icon: Cpu, color: 'text-purple-400', label: 'CPU Load', value: `${Math.round(cpuLoad)}%` },
                        { icon: Coins, color: 'text-yellow-400', label: 'Total FP', value: totalPoints.toLocaleString() },
                        { icon: Signal, color: 'text-cyan-400', label: 'Uplink', value: '1.2 Gbps' },
                        { icon: Shield, color: 'text-emerald-400', label: 'Firewall', value: 'SECURE' }
                        ].map((stat, i) => (
                        <div key={i} className="bg-white/5 border border-white/10 rounded-2xl p-4 flex flex-col items-center justify-center text-center hover:bg-white/10 transition-all cursor-crosshair group backdrop-blur-md shadow-lg">
                            <stat.icon className={`${stat.color} mb-2 group-hover:scale-110 transition-transform drop-shadow-md`} size={20} />
                            <span className="text-xl font-bold text-white font-mono tracking-tight">{stat.value}</span>
                            <span className="text-[10px] text-slate-500 uppercase tracking-wider mt-1">{stat.label}</span>
                        </div>
                        ))}
                    </div>
                </div>
            );
        };

        // --- POINTS MANAGER ---
        const PointsManager = ({ users = [], addUser, modifyPoints, deleteUser }) => {
            const [input, setInput] = useState('');

            const handleAdd = (e) => {
                e.preventDefault();
                if(input) { addUser(input); setInput(''); }
            };

            return (
                <div className="animate-fade-in space-y-8 pb-20">
                    <div className="flex flex-col md:flex-row justify-between items-end border-b border-white/10 pb-6 gap-4">
                        <div>
                        <h2 className="text-4xl font-black text-white tracking-tighter mb-2 drop-shadow-lg">POINTS MANAGER</h2>
                        <p className="text-slate-400 text-sm font-medium flex items-center gap-2">
                            <span className="w-2 h-2 bg-indigo-500 rounded-full animate-pulse shadow-[0_0_10px_#6366f1]"></span> Database Active
                        </p>
                        </div>
                        <form onSubmit={handleAdd} className="flex gap-2 w-full md:w-auto">
                        <input 
                            value={input} 
                            onChange={e => setInput(e.target.value)} 
                            placeholder="Initialize User..." 
                            className="w-full md:w-64 bg-black/40 border border-white/10 rounded-xl px-4 py-3 text-white outline-none focus:border-indigo-500 text-sm placeholder-slate-600 font-mono transition-all backdrop-blur-sm" 
                        />
                        <button className="bg-white/10 hover:bg-indigo-600 px-4 py-2 rounded-xl text-white transition-all backdrop-blur-sm border border-white/5">
                            <Plus size={20}/>
                        </button>
                        </form>
                    </div>
                    
                    <div className="grid grid-cols-1 md:grid-cols-2 gap-6">
                        {users.map(u => {
                            const safePoints = u.points || 0;
                            const tier = TIERS.find(t => safePoints >= t.min && safePoints < t.max) || TIERS[TIERS.length - 1];
                            const TierIcon = tier.icon;
                            const nextTier = TIERS[TIERS.indexOf(tier) + 1];
                            
                            let progress = 100;
                            if (nextTier) {
                                progress = ((safePoints - tier.min) / (nextTier.min - tier.min)) * 100;
                                progress = Math.min(100, Math.max(0, progress));
                            }
                            
                            return (
                                <div key={u.id} className="group relative bg-[#0a0a0a]/60 border border-white/10 p-6 rounded-[1.5rem] overflow-hidden hover:border-white/20 transition-all hover:shadow-[0_10px_40px_-10px_rgba(255,255,255,0.05)] hover:-translate-y-1 backdrop-blur-xl">
                      
